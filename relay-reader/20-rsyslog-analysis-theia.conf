module(load="imtcp")
input(type="imtcp" port="514")

# for Ubuntu 16.04
# apt install rsyslog-relp
module(load="imrelp") # needs to be done just once
input(type="imrelp" port="20514")

template(name="TheiaFormat" type="list") {
    property(name="msg" spifno1stsp="on" )
    property(name="msg" droplastlf="on" )
    constant(value="\n")
    }

#mkdir -p /data/log
#chown syslog:adm /data/log
template (name="TheiaDump" type="string"
    string="/data/log/ahg.dump-%HOSTNAME%"
    )

#receive remote logs
:inputname, isequal, "imtcp" action(type="omfile" dynaFile="TheiaDump" template="TheiaFormat")
:inputname, isequal, "imrelp" action(type="omfile" dynaFile="TheiaDump" template="TheiaFormat")

#drop remote message before they go to the rest of syslog
:inputname, isequal, "imtcp" stop
:inputname, isequal, "imrelp" stop
